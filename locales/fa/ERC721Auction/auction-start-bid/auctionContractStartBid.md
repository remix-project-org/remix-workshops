در این بخش، ما یک تابع برای شروع حراج و یک تابع برای پیشنهاد قیمت روی NFT ایجاد خواهیم کرد.

### شروع کنید

ما از برخی ساختارهای کنترلی استفاده می‌کنیم تا بررسی کنیم که آیا شرایط لازم قبل از اینکه به فروشنده اجازه دهیم حراج را شروع کند، برآورده شده‌اند یا خیر.

ابتدا بررسی می‌کنیم که آیا حراج از قبل شروع شده است یا خیر (خط ۴۹). اگر شروع شده باشد و متغیر وضعیت ما یعنی «started» مقدار «true» را برگرداند، از تابع خارج می‌شویم و یک استثنا ایجاد می‌کنیم.

شرط دومی که بررسی می‌کنیم این است که آیا فروشنده تابع را اجرا می‌کند یا خیر (خط ۵۰). ما قبلاً تابعی برای ذخیره آدرس فروشنده هنگام استقرار قرارداد در متغیر وضعیت `seller` ایجاد کرده‌ایم و اکنون می‌توانیم بررسی کنیم که آیا حسابی که تابع شروع را اجرا می‌کند، فروشنده است یا خیر. اگر نه، یک استثنا ایجاد می‌کنیم.

در مرحله بعد، می‌خواهیم NFT که برای حراج گذاشته شده است را از فروشنده به قرارداد منتقل کنیم (خط ۵۲).
ما متغیر وضعیت «شروع شده» را روی «درست» تنظیم می‌کنیم (خط ۵۳) و یک تاریخ پایان برای حراج ایجاد می‌کنیم (خط ۵۴). در این حالت، هفت روز از زمانی که تابع start فراخوانی شده است، می‌گذرد. می‌توانیم از پسوندی مانند «روزها» بعد از یک عدد حقیقی برای مشخص کردن واحدهای زمانی استفاده کنیم. اگر می‌خواهید درباره واحدهای زمانی بیشتر بدانید، نگاهی به <a href="https://docs.soliditylang.org/en/latest/units-and-global-variables.html#time-units" target="_blank">مستندات سالیدیتی</a> بیندازید.

در نهایت، رویداد `Start()` خود را منتشر خواهیم کرد (خط ۵۶).

### مناقصه

قبل از اینکه فراخوانی‌کننده‌ی تابع بتواند پیشنهادی ارائه دهد، باید مطمئن شویم که شرایط خاصی برقرار است. حراج باید شروع شده باشد (خط ۶۰)، حراج نمی‌تواند پایان یافته باشد (خط ۶۱) و پیشنهاد (مقدار ضمیمه شده به فراخوان) باید بالاتر از بالاترین پیشنهاد فعلی باشد (خط ۶۲).

اکنون می‌خواهیم قبل از ارائه پیشنهاد جدید، پیشنهاد بالاترین پیشنهاد دهنده فعلی را ذخیره کنیم.
ابتدا بررسی می‌کنیم که آیا پیشنهاد دهنده‌ای وجود دارد یا خیر (خط ۶۴). اگر این فراخوانی تابع اولین پیشنهاد باشد، خط بعدی بی‌ربط خواهد بود.
در نگاشت «پیشنهادها» (خط ۳۴)، کلید، یعنی «آدرس» پیشنهاددهنده، را به مقدار، یعنی یک «واحد» uint که نشان دهنده کل مبلغ ETH است که یک پیشنهاددهنده قبل از انصراف در حراج پیشنهاد داده است، نگاشت می‌کنیم.
اگر پیشنهاددهنده‌ای وجود داشته باشد، آخرین پیشنهاد ("بالاترین پیشنهاد") "بالاترین پیشنهاددهنده" را قبل از انصراف به کل ارزش پیشنهادهای ارائه شده توسط آنها (خط ۶۵) اضافه می‌کنیم.
ما پیشنهادها را ذخیره می‌کنیم زیرا می‌خواهیم پیشنهاددهنده را قادر سازیم که اگر دیگر بالاترین پیشنهاد را ندهد، ETH مورد استفاده برای ارائه پیشنهاد را برداشت کند.

در مرحله بعد، `highestBidder` را روی حسابی که تابع را فراخوانی می‌کند (خط ۶۸) و `highestBid` را روی پیشنهاد آنها، مقداری که با فراخوانی ارسال شده است (خط ۶۹)، تنظیم می‌کنیم.

در نهایت، رویداد `Bid` را منتشر می‌کنیم (خط ۷۱).

## ⭐️ تکلیف

1. یک قرارداد NFT راه‌اندازی کنید. شما می‌توانید از قرارداد NFT که ما در دوره آموزشی «Solidity NFT Course» ایجاد می‌کنیم، استفاده کنید.

2. برای خودتان یک NFT با شناسه توکن ۰ ایجاد کنید.

3. این قرارداد EnglishAuction را مستقر کنید. از آدرس قرارداد NFT به عنوان آرگومان برای پارامتر `_nft`، 0 برای `_nftId` و 1 برای `_startingBid` استفاده کنید.

4. تابع «تأیید» قرارداد NFT خود را با آدرس قرارداد حراج به عنوان آرگومان برای پارامتر «to» و ۰ برای «tokenId» فراخوانی کنید. این به قرارداد اجازه می‌دهد تا توکن مورد نظر برای حراج را منتقل کند.

5. تابع «شروع» قرارداد حراج خود را فراخوانی کنید. اگر اکنون تابع `started` را فراخوانی کنید، باید `true` را برگرداند. اگر تابع `highestBid` را فراخوانی کنید، باید مقدار ۱ را برگرداند.

6. مقداری را که می‌توانید به تراکنش‌ها پیوست کنید، روی ۳Wei تنظیم کنید و تابع «پیشنهاد» از contracturn 3 مربوط به حراج را فراخوانی کنید. اگر تابع `highestBid` را فراخوانی کنید، اکنون باید مقدار ۳ را برگرداند.