در این آموزش قرارداد، یاد خواهیم گرفت که چگونه یک قرارداد حراج ERC721 (NFT) ایجاد کنیم.
قبل از شروع این آموزش، به شما توصیه می‌کنیم که دوره آموزشی «Solidity NFT» را بگذرانید.

در بخش‌های بعدی، قراردادی ایجاد خواهیم کرد که به فروشنده امکان می‌دهد یک NFT را به بالاترین پیشنهاد دهنده حراج کند. این قرارداد توسط پروژه <a href="https://solidity-by-example.org/app/english-auction/" target="_blank">Solidity by Example</a> ایجاد شده است. در این بخش اول، یک رابط، متغیرهای حالت لازم و سازنده constructor را ایجاد خواهیم کرد.

### رابط

ما رابط (خط ۵) را برای توکن ERC721 ایجاد می‌کنیم، زیرا قرارداد ما نیاز به تعامل با آن دارد. ما به متدهای `safeTransferFrom` (خط ۵) و `transferFrom` (خط ۱۱) نیاز خواهیم داشت.

### حراج انگلیسی

ما چهار رویداد `Start`، `Bid`، `Withdraw`، `End` (خطوط ۱۹-۲۲) را ایجاد می‌کنیم تا بتوانیم تعاملات مهم را ثبت کنیم.

در مرحله بعد، متغیرهای وضعیت را ایجاد خواهیم کرد که تمام اطلاعات لازم در مورد حراج درون زنجیره‌ای ما را ذخیره می‌کنند.

ما دو متغیر حالت برای NFT که می‌خواهیم به حراج بگذاریم، ایجاد می‌کنیم. در متغیر `nft` (خط 24) نمایشی از قرارداد NFT را ذخیره می‌کنیم که به ما امکان می‌دهد توابع آن را با ترکیب رابط IERC721 و آدرس قرارداد NFT فراخوانی کنیم.
در `nftId` (خط ۲۵)، شناسه توکن خاص را در قرارداد NFT خود کهبه حراج گذاشته خواهد شد، ذخیره می‌کنیم.

در مرحله بعد، به یک متغیر نیاز داریم تا آدرس شخصی که NFT را به حراج می‌گذارد، یعنی «فروشنده» (خط ۲۷) را در آن ذخیره کند.
ما می‌خواهیم قرارداد NFT ما پس از اتمام حراج، درآمد حاصل از آن را برای فروشنده ارسال کند، به همین دلیل از «آدرس قابل پرداخت» استفاده می‌کنیم.

ما یک متغیر وضعیت به نام `endAt` (خط ۲۸) ایجاد می‌کنیم که در آن تاریخ پایان حراج را ذخیره خواهیم کرد.
ما همچنین دو مقدار بولی «started» (خط ۲۹) و «ended» (خط ۳۰) را ایجاد می‌کنیم که شروع یا پایان حراج را پیگیری می‌کنند.

ما یک متغیر به نام `highestBidder` (خط ۳۲) ایجاد می‌کنیم که آدرس بالاترین پیشنهاد دهنده را در آن ذخیره خواهیم کرد. پس از پایان حراج، NFT را برای بالاترین پیشنهاد دهنده ارسال خواهیم کرد.

در نهایت، به یک متغیر uint به نام `highestBid` (خط ۳۳) برای ذخیره بالاترین پیشنهاد و یک نگاشت `bids` (خط ۳۴) نیاز داریم که در آن بتوانیم کل ارزش پیشنهادهایی را که یک حساب قبل از برداشت انجام داده است، ذخیره کنیم؛ در بخش بعدی بیشتر در این مورد صحبت خواهیم کرد.

### سازنده

وقتی حراج‌گذار قرارداد را اجرا می‌کند، باید چند آرگومان ارائه دهد: آدرس قرارداد NFT که می‌خواهند حراج کنند `_nft` (خط ۳۷)، شناسه توکن NFT که می‌خواهند حراج کنند `_nftId` (خط ۳۸) و قیمت شروعی که باید برای قرار دادن اولین پیشنهاد در حراج، `_startingBid` (خط ۳۹) بیشتر از قیمت پیشنهادی اولیه باشد.

پس از استقرار، به متغیرهای حالت `nft` (خط ۴۱)، `nftId` (خط ۴۲) و `highestBid` (خط ۴۵) مقادیری از آرگومان‌ها اختصاص داده خواهد شد. آدرس «فروشنده» که قرارداد را مستقر کرده است، به طور خودکار از طریق msg.sender خوانده شده و در متغیر state `seller` (خط ۴۴) ذخیره می‌شود.

در بخش بعدی، به حراج‌گذار اجازه می‌دهیم تا حراج را شروع کند و پیشنهاددهندگان نیز می‌توانند پیشنهادات خود را ارائه دهند.

## ⭐️ تکلیف

ما از بخش واگذاری بخش‌های بعدی برای ارائه دستورالعمل‌هایی در مورد آزمایش قرارداد شما در محیط Remix VM ریمیکس استفاده خواهیم کرد.

1. یک قرارداد NFT راه‌اندازی کنید. شما می‌توانید از قرارداد NFT که در بخش «ایجاد توکن - ERC721 3.3» ایجاد کرده‌ایم، استفاده کنید.

2. این قرارداد EnglishAuction را مستقر کنید. از آدرس قرارداد NFT به عنوان آرگومان برای پارامتر `_nft`، 0 برای `_nftId` و 1 برای `_startingBid` استفاده کنید.

3. پس از استقرار قرارداد، بررسی کنید که آیا توابع قرارداد مانند `nft`، `nftId` و `started` طبق انتظار کار می‌کنند یا خیر.