در این بخش، فرآیند ارسال و تأیید تراکنش‌ها را بررسی خواهیم کرد.

## اصلاح کننده ها

ما در این نسخه از قرارداد، اصلاح‌کننده‌های جدیدی داریم. بیایید آنها را یک به یک بررسی کنیم.

1. اصلاح‌کننده‌ی **txExists:** (خط ۱۳) تضمین می‌کند که تراکنش وجود دارد. این کار را با بررسی اینکه آیا شاخص تراکنش کمتر از طول آرایه `transactions` است یا خیر، انجام می‌دهد. در ادامه‌ی این بخش، بیشتر در مورد این اصلاح‌کننده صحبت خواهیم کرد.
2. اصلاح‌کننده‌ی **`notExecuted`:** (خط ۱۸) تضمین می‌کند که تراکنش اجرا نشده است. این کار را با بررسی اینکه آیا متغیر «اجرا شده» تراکنش نادرست است یا خیر، انجام می‌دهد.
3. اصلاح‌کننده‌ی **`notConfirmed`:** (خط ۲۳) تضمین می‌کند که تراکنش توسط فراخوانی‌کننده تأیید نشده است. این کار را با بررسی اینکه آیا نگاشت `isConfirmed` از شاخص تراکنش و آدرس تماس‌گیرنده نادرست است یا خیر، انجام می‌دهد.

## ساختار تراکنش

در خط ۲۸، ما یک struct به نام `Transaction` داریم. ما اعضای ساختار: `to`، `value`، `data`، `executed` و `numConfirmations` را در متغیرهای جداگانه ذخیره می‌کنیم.

## نگاشت تأییدیه‌ها

در خط ۳۷، ما یک نگاشت به نام `isConfirmed` داریم. این نگاشت برای پیگیری تأییدیه‌های هر تراکنش استفاده می‌شود. این تابع، اندیس تراکنش را به نگاشتی از آدرس مالک به یک مقدار بولی نگاشت می‌کند. مقدار بولی نشان می‌دهد که آیا این مالک تراکنش را تأیید کرده است یا خیر.

## آرایه تراکنش‌ها

در خط ۳۹، آرایه‌ای به نام `transactions` داریم. این آرایه برای ذخیره تمام تراکنش‌های ارسال شده به کیف پول چند امضایی استفاده می‌شود.

## رویدادها

ما در این نسخه از قرارداد، چهار رویداد جدید داریم:

1. رویداد `SubmitTransaction`: هر زمان که تراکنشی به کیف پول چندامضایی ارسال شود، منتشر می‌شود.
2. رویداد **`ConfirmTransaction`:** هر زمان که یک تراکنش توسط مالک تأیید شود، منتشر می‌شود.
3. رویداد `RevokeConfirmation`: هر زمان که تأیید تراکنش توسط مالک لغو شود، منتشر می‌شود.
4. رویداد `ExecuteTransaction`: هر زمان که یک تراکنش اجرا شود، منتشر می‌شود.

## ارائه تابع تراکنش

تابع `submitTransaction` (خط ۷۸) به کاربران اجازه می‌دهد تا تراکنشی را به کیف پول چندامضایی ارسال کنند. این تابع سه پارامتر می‌گیرد: `to`، `value` و `data`. پارامتر `to` آدرس گیرنده تراکنش است. پارامتر «مقدار» مقدار اتری است که قرار است ارسال شود. پارامتر `data` داده‌ای است که قرار است به گیرنده ارسال شود. فقط مالکان می‌توانند تراکنش‌ها را ارسال کنند.

در خط ۸۵، یک ساختار تراکنش جدید ایجاد می‌کنیم و آن را به آرایه `transactions` ارسال می‌کنیم و رویداد `SubmitTransaction` را منتشر می‌کنیم. متغیر `txIndex` برای پیگیری شاخص تراکنش استفاده می‌شود.

## تایید عملکرد تراکنش

تابع `confirmTransaction` (خط ۹۸) به کاربران اجازه می‌دهد تا یک تراکنش را تأیید کنند. این تابع یک پارامتر به نام `txIndex` دریافت می‌کند.
این شامل سه اصلاح‌کننده است: `onlyOwner`، `txExists` و `notExecuted`. اصلاح‌کننده‌ی «onlyOwner» تضمین می‌کند که فقط مالکان می‌توانند تراکنش‌ها را تأیید کنند. اصلاح‌کننده‌ی `txExists` تضمین می‌کند که تراکنش وجود دارد. اصلاح‌کننده‌ی `notExecuted` تضمین می‌کند که تراکنش اجرا نشده است.

در خط ۱۰۱، تراکنش را در یک متغیر محلی به نام `transaction` ذخیره می‌کنیم. سپس متغیر `numConfirmations` تراکنش را افزایش می‌دهیم و نگاشت `isConfirmed` اندیس تراکنش و آدرس فراخواننده را روی true تنظیم می‌کنیم. در نهایت، رویداد `ConfirmTransaction` را منتشر می‌کنیم.

## executeTransaction Function

تابع `executeTransaction` (خط 108) به کاربران اجازه می‌دهد تا یک تراکنش را اجرا کنند. در خط ۱۱۳، ما الزام می‌کنیم که تعداد تأییدهای تراکنش بزرگتر یا مساوی تعداد تأییدهای مورد نیاز باشد. سپس متغیر `executed` تراکنش را روی true تنظیم می‌کنیم. در نهایت، با استفاده از تابع `call` وجه را ارسال کنید.  این «فراخوانی» آدرس گیرنده با مقدار و داده‌های تراکنش است. اگر تراکنش موفقیت‌آمیز باشد، رویداد `ExecuteTransaction` را منتشر می‌کنیم.

## تابع getTransactionCount

تابع `getTransactionCount` (خط ۱۳۲) به کاربران اجازه می‌دهد تا تعداد تراکنش‌های موجود در کیف پول چندامضایی را بازیابی کنند. طول آرایه `transactions` را برمی‌گرداند.

## تابع getTransaction

تابع `getTransaction` (خط ۱۳۶) به کاربران اجازه می‌دهد تا یک تراکنش را بازیابی کنند. این تابع اعضای ساختار تراکنش را که قبلاً در این بخش بررسی کردیم، برمی‌گرداند.

## نتیجه گیری

در این بخش، فرآیند ارسال، تأیید و اجرای تراکنش‌ها را بررسی کردیم. ما توابع `submitTransaction`، `confirmTransaction` و `executeTransaction` را بررسی کردیم و فهمیدیم که چگونه آنها با هم کار می‌کنند تا به چندین کاربر امکان ارسال و تأیید تراکنش‌ها را بدهند.

## ⭐️ تکلیف: انجام تراکنش

ارسال، تأیید و اجرای تراکنش برای ارسال ۲ اتر به اولین حساب در منوی کشویی «حساب‌ها».

1. قرارداد چندامضایی را مانند تکلیف قبلی مستقر کنید. مطمئن شوید که تعداد تاییدیه‌های مورد نیاز ۲ است.
2. با ارسال ۴ اتر، همانطور که در تکلیف قبلی انجام دادید، از هر آدرسی، چندامضایی را تأمین مالی کنید.
3. سعی کنید ۲ اتر را به اولین حساب در منوی کشویی «حساب‌ها» ارسال کنید.  پس از ارسال این تراکنش (با submitTransaction)، روی «getTransactionCount» کلیک کنید و باید یک تراکنش را ببینید یا می‌توانید روی «getTransaction» کلیک کنید، عدد ۰ را به عنوان اندیس تراکنش وارد کنید و تراکنشی را که ارسال کرده‌اید، ببینید.
4. حالا می‌توانید روی «confirmTransaction» کلیک کنید و عدد ۰ را به عنوان اندیس تراکنش وارد کنید. اگر دوباره روی «getTransaction» کلیک کنید، باید ببینید که تراکنش یک بار تأیید شده است.
5. به حساب مالک دوم بروید و دوباره تراکنش را تأیید کنید. اگر دوباره روی «getTransaction» کلیک کنید، باید ببینید که تراکنش دو بار تأیید شده است.
6. آخرین مرحله، اجرای تراکنش است. روی «executeTransaction» کلیک کنید و عدد ۰ را به عنوان اندیس تراکنش وارد کنید. اگر دوباره روی `getTransaction` کلیک کنید، باید ببینید که تراکنش اجرا شده است. همچنین می‌توانید موجودی حساب اول را در منوی کشویی «حساب‌ها» بررسی کنید. اکنون باید ۲ اتر بیشتر و موجودی کیف پول چندامضایی ۲ اتر کمتر شده باشد.

اگر تراکنشی را ارسال می‌کنید، مطمئن شوید که مقدار آن به Wei باشد و فیلد _data به درستی پر شده باشد. به عنوان مثال. می‌تواند به این شکل باشد: "0x5B38Da6a701c568545dCfcB03FcB875f56beddC4, 200000000000000000, 0x" برای 2 اتر.